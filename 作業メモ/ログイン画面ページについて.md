# 認証（ログイン）ページを作る

使うもの

- [tailwindcss](https://tailwindcss.com/docs/guides/nextjs)
- supabase/ui
- @supabase/supabase-js

必要なファイル

- .env.local
- supabaseClient.js
- index.js

やること

- 各ライブラリをインストール（既にしていたら OK）
- 各ファイル作成（コードも含め）
- vercel にデプロイ（どの道いつかしないといけないが URL が欲しいため）＝＞今必要なし（http://localhost:3000/で良い）
- github の認証機能を実装する（URL が必要 ⇧ でいい）

起きたエラー

- ログインした際に認証しているのにログイン画面に戻される
  - \_app.js で Auth.UserContextProvider で囲っていなかったことが原因

参考ページ

- [github から supabase に貼るキーを入手する](https://docs.github.com/ja/developers/apps/building-oauth-apps/creating-an-oauth-app)
- [supabase の Auth のページ](https://supabase.io/docs/guides/auth)

github で打つコード

- Application name
  - 任意の名前でいい
- Homepage URL
  - http://localhost:3000/
- Authorization callback URL
  - https://YOUR_SUPABASE_URL/auth/v1/callback
  - .env.local に記述している YOUR_SUPABASE_URL の後に/auth/v1/callback を貼り付けたものを貼る

 <img width="1385" alt="スクリーンショット 2021-07-19 3 16 19" src="https://user-images.githubusercontent.com/79749395/126079621-eb4b7bb2-cb2e-40a6-9e89-e0707161bfca.png">

supabase で打つコード

- GitHub client ID
  - github の Client ID
- GitHub secret
  - github の Client secrets

 <img width="1061" alt="スクリーンショット 2021-07-19 4 15 37" src="https://user-images.githubusercontent.com/79749395/126079604-4cf62a51-bb4d-4c46-96ed-b865963dae54.png">

```js
// .env.local
NEXT_PUBLIC_SUPABASE_URL=https://vt......co
NEXT_PUBLIC_SUPABASE_ANON_KEY=ey........Nwo
```

```js
// supabaseClient.js
import { createClient } from '@supabase/supabase-js';

export const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
);
```

```js
// index.js;

import { supabase } from 'utils/supabaseClient';
import { Auth, Button } from '@supabase/ui';

export default function IndexPage() {
  const { user } = Auth.useUser();

  return (
    <div className="w-full h-full bg-gray-300  ">
      {!user ? (
        <div className="w-full h-full flex justify-center items-center p-4">
          <Auth
            supabaseClient={supabase}
            providers={['google', 'github']}
            socialLayout="horizontal"
            socialButtonSize="xlarge"
          />
        </div>
      ) : (
        <div
          className="w-full h-full flex flex-col justify-center items-center p-4"
          style={{ minWidth: 250, maxWidth: 600, margin: 'auto' }}
        >
          <Button
            className="btn-black w-full mt-12"
            onClick={async () => {
              const { error } = await supabase.auth.signOut();
              if (error) console.log('Error logging out:', error.message);
            }}
          >
            Logout
          </Button>
        </div>
      )}
    </div>
  );
}
```

```js
// import 'tailwindcss/tailwind.css';
// import { ChakraProvider } from '@chakra-ui/react';
import { Auth } from '@supabase/ui';
import { supabase } from 'utils/supabaseClient';
function MyApp({ Component, pageProps }) {
  return (
    // <ChakraProvider>
    <Auth.UserContextProvider supabaseClient={supabase}>
      <Component {...pageProps} />
    </Auth.UserContextProvider>
    // </ChakraProvider>
  );
}

export default MyApp;
```

# うまくいっていれば github 認証ボタンを押すと

<img width="782" alt="スクリーンショット 2021-07-19 3 58 17" src="https://user-images.githubusercontent.com/79749395/126079775-4cf5a667-b67e-4830-a318-bd69bbd9f164.png">

このような感じで連携ができる
